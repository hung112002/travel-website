<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <% if (travel) { %>
        <title><%= travel.name %> | Shimane Travel</title>
    <% } else { %>
        <title>è¦‹ã¤ã‹ã‚Šã¾ã›ã‚“</title>
    <% } %>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@400;700&family=Noto+Sans+JP:wght@300;400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/css/style.css">
</head>

<body class="admin-body">
    <div id="page-loader" class="page-loader">
        <div class="loader-spinner"></div>
    </div>

    <header class="main-header">
        <div class="nav-container">
            <div class="logo">
                <a href="/">
                    <svg width="35" height="35" viewBox="0 0 100 100" fill="none" class="logo-icon">
                        <circle cx="35.5" cy="35.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                        <circle cx="64.5" cy="35.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                        <circle cx="35.5" cy="64.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                        <circle cx="64.5" cy="64.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                    </svg>
                    <span class="logo-text">Shimane<span>Travel</span></span>
                </a>
            </div>
            <nav class="nav-links">
                <a href="/" class="nav-item">ãƒ›ãƒ¼ãƒ </a>
                <a href="/cuisine" class="nav-item">ã‚°ãƒ«ãƒ¡</a>
                <a href="/people" class="nav-item">åŒ ãƒ»äººç‰©</a>
                <a href="/all-destinations" class="nav-item">å…¨ã¦ã®è¦³å…‰åœ°</a>

                <% if (user) { %>
                    <div class="user-actions">
                        <a href="/profile" class="btn-member">
                            ğŸ‘¤ <%= user.username %>
                        </a>
                        <a href="/logout" class="btn-logout">ãƒ­ã‚°ã‚¢ã‚¦ãƒˆ</a>
                    </div>
                <% } else { %>
                    <a href="/login" class="btn-member">ãƒ­ã‚°ã‚¤ãƒ³</a>
                <% } %>
            </nav>
        </div>
    </header>

    <main class="detail-container" style="max-width: 1000px; margin: 120px auto 50px auto; padding: 0 20px;">
    <% if (travel) { %>
        <% if (travel.notice_text) { %>
            <div class="alert-box" style="background: #fff3f3; border-left: 5px solid #d32f2f; padding: 15px; margin-bottom: 20px; border-radius: 4px;">
                <h4 style="color: #d3a72f; margin: 0;">âš ï¸ ã€é‡è¦ãªãŠçŸ¥ã‚‰ã›ã€‘</h4>
                <p style="margin: 5px 0 0 0; font-size: 0.95rem;"><%= travel.notice_text %></p>
            </div>
        <% } %>

        <div class="detail-hero-section">
            <div class="detail-hero-content">
                <p class="detail-hero-tag" style="color: #c5a059; font-weight: bold;">
                    <%= travel.location %> 
                    <% if (travel.best_season) { %> | ğŸŒ¸ <%= travel.best_season %><% } %>
                </p>
                <h1 style="font-family: 'Noto Serif JP', serif; font-size: 2.5rem; margin-bottom: 20px;"><%= travel.name %></h1>
                <pre class="detail-hero-desc" style="white-space: pre-wrap; font-family: 'Noto Sans JP', sans-serif; line-height: 1.8; margin-bottom: 30px;"><%= travel.description %></pre>
                
                <div class="fav-action-container" style="margin: 20px 0;">
                    <button id="favBtn" class="btn-luxury" style="width: auto; padding: 12px 25px; display: flex; align-items: center; gap: 10px; cursor: pointer; background: #0c1a32; color: #c5a059; border: 1px solid #c5a059; border-radius: 4px; font-weight: bold;">
                        <span id="favIcon">â¤ï¸</span> <span id="favText">ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ </span>
                    </button>
                </div>
            </div>
            <div class="detail-hero-image" style="margin-top: 30px;">
                <img src="<%= travel.imageUrl || 'https://via.placeholder.com/600' %>" alt="<%= travel.name %>" style="width: 100%; border-radius: 8px; box-shadow: 0 10px 30px rgba(0,0,0,0.1);">
            </div>
        </div>

        <div class="detail-info-section" style="display: flex; gap: 40px; margin-top: 60px; flex-wrap: wrap;">
            <div class="detail-map" style="flex: 1; min-width: 300px;">
                <% if (travel.map_iframe) { %>
                    <iframe 
                      src="<%= travel.map_iframe %>" 
                      width="100%" height="450" style="border:0; border-radius: 8px;" allowfullscreen="" loading="lazy">
                    </iframe>
                <% } else { %>
                    <div style="height: 450px; background: #eee; display: flex; align-items: center; justify-content: center; border-radius: 8px;">
                        åœ°å›³æƒ…å ±ãŒã‚ã‚Šã¾ã›ã‚“
                    </div>
                <% } %>
            </div>

            <div class="detail-info-list" style="flex: 1; min-width: 300px; background: #fff; padding: 30px; border-radius: 8px; box-shadow: 0 5px 15px rgba(0,0,0,0.05);">
                <h2 style="font-family: 'Noto Serif JP', serif; border-bottom: 2px solid #c5a059; padding-bottom: 10px; margin-bottom: 20px; color: #333;">åŸºæœ¬æƒ…å ±</h2>
                <dl style="display: grid; grid-template-columns: 110px 1fr; gap: 15px 20px;">
                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">ä½æ‰€</dt>
                    <dd style="color: #333; font-size: 0.95rem;"><%= travel.location %></dd>

                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">å–¶æ¥­æ™‚é–“</dt>
                    <dd style="color: <% if (travel.opening_hours) { %>#333<% } else { %>#999<% } %>; font-size: 0.95rem;">
                        <%= travel.opening_hours || 'æƒ…å ±æœªç™»éŒ²' %>
                    </dd>
                    
                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">å®šä¼‘æ—¥</dt>
                    <dd style="color: <% if (travel.closed_days) { %>#333<% } else { %>#999<% } %>; font-size: 0.95rem;">
                        <%= travel.closed_days || 'æƒ…å ±æœªç™»éŒ²' %>
                    </dd>

                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">é›»è©±ç•ªå·</dt>
                    <dd style="color: <% if (travel.phone) { %>#c5a059<% } else { %>#999<% } %>; font-size: 0.95rem;">
                        <% if (travel.phone) { %>
                            <a href="tel:<%= travel.phone %>" style="color: #c5a059; text-decoration: none;"><%= travel.phone %></a>
                        <% } else { %>
                            æƒ…å ±æœªç™»éŒ²
                        <% } %>
                    </dd>

                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">ã‚¢ã‚¯ã‚»ã‚¹</dt>
                    <dd style="color: <% if (travel.access) { %>#333<% } else { %>#999<% } %>; font-size: 0.95rem;">
                        <%= travel.access || 'æƒ…å ±æœªç™»éŒ²' %>
                    </dd>
                    
                    <dt style="font-weight: 600; color: #555; font-size: 0.95rem;">å…¬å¼ã‚µã‚¤ãƒˆ</dt>
                    <dd style="font-size: 0.95rem;">
                        <% if (travel.website_url) { %>
                            <a href="<%= travel.website_url %>" target="_blank" rel="noopener noreferrer" style="color: #c5a059; text-decoration: underline; word-break: break-all;"><%= travel.website_url %></a>
                        <% } else { %>
                            <span style="color: #999;">æƒ…å ±æœªç™»éŒ²</span>
                        <% } %>
                    </dd>

                    <% if (travel.news_update) { %>
                        <dt style="font-weight: 600; color: #d32f2f; font-size: 0.95rem;">ğŸ“¢ æœ€æ–°ãƒ‹ãƒ¥ãƒ¼ã‚¹</dt>
                        <dd style="color: #333; font-size: 0.95rem; background: #fff9f9; padding: 8px 10px; border-left: 3px solid #d32f2f;"><%= travel.news_update %></dd>
                    <% } %>
                </dl>
            </div>
        </div>

        <% if (typeof images !== 'undefined' && images.length > 0) { %>
            <div class="photo-gallery-section" style="margin-top: 60px;">
                <h2 style="font-family: 'Noto Serif JP', serif; margin-bottom: 30px; text-align: center;">ãƒ•ã‚©ãƒˆã‚®ãƒ£ãƒ©ãƒªãƒ¼</h2>
                <div class="gallery-grid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 15px;">
                    <% images.forEach(function(img) { %>
                        <div class="gallery-item">
                            <img src="<%= img.image_url %>" style="width: 100%; height: 200px; object-fit: cover; border-radius: 4px; transition: 0.3s; cursor: pointer;" onmouseover="this.style.transform='scale(1.03)'" onmouseout="this.style.transform='scale(1)'">
                        </div>
                    <% }); %>
                </div>
            </div>
        <% } %>

    <% } else { %>
        <% } %>
</main>

    <section class="recommend-section" style="background: #f9f9f9; padding: 80px 0;">
        <div style="max-width: 1000px; margin: 0 auto; padding: 0 20px;">
            <h2 class="recommend-title" style="display: flex; align-items: center; gap: 15px; font-family: 'Noto Serif JP', serif; margin-bottom: 40px;">
                <svg width="28" height="28" viewBox="0 0 100 100" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <circle cx="35.5" cy="35.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                    <circle cx="64.5" cy="35.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                    <circle cx="35.5" cy="64.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                    <circle cx="64.5" cy="64.5" r="17.5" stroke="#c5a059" stroke-width="8"/>
                </svg>
                ãŠã™ã™ã‚ã‚³ãƒ¼ã‚¹ 
            </h2>
            
            <div class="carousel-container" style="position: relative;">
                <button class="carousel-btn prev" id="prev-btn" style="position: absolute; left: -20px; top: 50%; z-index: 10; background: #fff; border: 1px solid #ddd; padding: 10px; cursor: pointer;">â€¹</button>
                <div class="recommend-grid" id="recommend-grid" style="display: flex; gap: 20px; overflow-x: hidden; scroll-behavior: smooth;">
                    <a href="/cuisine" class="recommend-card" style="min-width: 250px; background: #fff; text-decoration: none; color: inherit; border-radius: 4px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                        <img src="https://img-mdpr.freetls.fastly.net/article/A88T/wm/A88TfgxaTd1gZcfOUsu2uiCbU8QMv2lp3FOPc2aH_Zo.jpg?width=1400&auto=webp" style="width: 100%; height: 150px; object-fit: cover;">
                        <div class="recommend-content" style="padding: 15px;">
                            <span style="background: #c5a059; color: #fff; font-size: 0.7rem; padding: 2px 8px; border-radius: 2px;">ã‚°ãƒ«ãƒ¡</span>
                            <h3 style="font-size: 1rem; margin: 10px 0;">å³¶æ ¹ã®ã‚°ãƒ«ãƒ¡ã‚’ä½“é¨“</h3>
                        </div>
                    </a>
                    <a href="/people" class="recommend-card" style="min-width: 250px; background: #fff; text-decoration: none; color: inherit; border-radius: 4px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                        <img src="https://tabi.tetsunomichi.gr.jp/wp-content/uploads/page_japan-heritage-recognized_hero-1.jpg" style="width: 100%; height: 150px; object-fit: cover;">
                        <div class="recommend-content" style="padding: 15px;">
                            <span style="background: #c5a059; color: #fff; font-size: 0.7rem; padding: 2px 8px; border-radius: 2px;">åŒ ãƒ»äººç‰©</span>
                            <h3 style="font-size: 1rem; margin: 10px 0;">åŒ ã®æŠ€ã«è§¦ã‚Œã‚‹</h3>
                        </div>
                    </a>
                    <a href="/all-destinations" class="recommend-card" style="min-width: 250px; background: #fff; text-decoration: none; color: inherit; border-radius: 4px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                        <img src="https://img-www.knt.co.jp/travelguide/yado/image/travelguide_178_mv.jpg" style="width: 100%; height: 150px; object-fit: cover;">
                        <div class="recommend-content" style="padding: 15px;">
                            <span style="background: #c5a059; color: #fff; font-size: 0.7rem; padding: 2px 8px; border-radius: 2px;">æ¸©æ³‰</span>
                            <h3 style="font-size: 1rem; margin: 10px 0;">ç¾è‚Œã®æ¹¯ãƒ»æ¸©æ³‰å·¡ã‚Š</h3>
                        </div>
                    </a>
                    <a href="/all-destinations" class="recommend-card" style="min-width: 250px; background: #fff; text-decoration: none; color: inherit; border-radius: 4px; overflow: hidden; box-shadow: 0 3px 10px rgba(0,0,0,0.05);">
                        <img src="https://www.kankou-shimane.com/jp/wp-content/uploads/2020/03/363-tamazukurionsen-006-e1584853822575.jpg" style="width: 100%; height: 150px; object-fit: cover;">
                        <div class="recommend-content" style="padding: 15px;">
                            <span style="background: #c5a059; color: #fff; font-size: 0.7rem; padding: 2px 8px; border-radius: 2px;">æ¸©æ³‰</span>
                            <h3 style="font-size: 1rem; margin: 10px 0;">ç¾è‚Œã®æ¹¯ãƒ»æ¸©æ³‰å·¡ã‚Š</h3>
                        </div>
                    </a>
                </div>
                <button class="carousel-btn next" id="next-btn" style="position: absolute; right: -20px; top: 50%; z-index: 10; background: #fff; border: 1px solid #ddd; padding: 10px; cursor: pointer;">â€º</button>
            </div>
        </div>
    </section>

    <footer class="site-footer" style="background: #333; color: #fff; padding: 60px 0; text-align: center;">
        <div class="footer-links" style="margin-bottom: 30px; display: flex; justify-content: center; gap: 20px;">
            <a href="/" style="color: #ccc; text-decoration: none;">è¦³å…‰ã‚¬ã‚¤ãƒ‰</a>
            <a href="/" style="color: #ccc; text-decoration: none;">ãŠå•ã„åˆã‚ã›</a>
            <a href="/" style="color: #ccc; text-decoration: none;">é‹å–¶æƒ…å ±</a>
        </div>
        <div class="footer-logo" style="font-family: 'Noto Serif JP', serif; font-size: 1.5rem; color: #c5a059; margin-bottom: 10px;">
            Shimane Travel
        </div>
        <p style="font-size: 0.8rem; color: #888;">Â© 2025-2026 Shimane Project by HÃ¹ng (Shimane IT Design College)</p>
    </footer>

    <script>
 const isLoggedIn = <%= user ? 'true' : 'false' %>;
  const destinationId = <%- JSON.stringify(travel ? travel.id : null) %>;

  document.addEventListener('DOMContentLoaded', () => {
    // Carousel logic (luÃ´n cÃ³)
    const grid = document.getElementById('recommend-grid');
    const nextBtn = document.getElementById('next-btn');
    const prevBtn = document.getElementById('prev-btn');
    const scrollAmount = 300;

    if (nextBtn && grid) nextBtn.addEventListener('click', () => grid.scrollBy({ left: scrollAmount, behavior: 'smooth' }));
    if (prevBtn && grid) prevBtn.addEventListener('click', () => grid.scrollBy({ left: -scrollAmount, behavior: 'smooth' }));

    // Favorite logic (chá»‰ cháº¡y khi cÃ³ travel + cÃ³ nÃºt)
    const favBtn = document.getElementById('favBtn');
    if (!favBtn || !destinationId) return;

    favBtn.addEventListener('click', async () => {
      if (!isLoggedIn) {
        alert("ãŠæ°—ã«å…¥ã‚Šæ©Ÿèƒ½ã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚(Báº¡n cáº§n Ä‘Äƒng nháº­p Ä‘á»ƒ sá»­ dá»¥ng tÃ­nh nÄƒng nÃ y)");
        window.location.href = "/login";
        return;
      }

      try {
        const res = await fetch('/toggle-favorite', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ destinationId })
        });

        const data = await res.json();

        if (data.status === 'liked') {
          alert("ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ã—ã¾ã—ãŸï¼ (ÄÃ£ thÃªm vÃ o yÃªu thÃ­ch)");
          document.getElementById('favText').innerText = "ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤";
        } else {
          alert("ãŠæ°—ã«å…¥ã‚Šã‹ã‚‰å‰Šé™¤ã—ã¾ã—ãŸã€‚ (ÄÃ£ xÃ³a khá»i yÃªu thÃ­ch)");
          document.getElementById('favText').innerText = "ãŠæ°—ã«å…¥ã‚Šã«è¿½åŠ ";
        }
      } catch (error) {
        console.error("Error toggling favorite:", error);
        alert("ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸã€‚ã‚‚ã†ä¸€åº¦ãŠè©¦ã—ãã ã•ã„ã€‚");
      }
    });
  });
</script>

<script>
  // Header scroll effect
  window.addEventListener('scroll', function() {
    const header = document.querySelector('.main-header');
    if (window.scrollY > 80) {
      header.classList.add('scrolled');
    } else {
      header.classList.remove('scrolled');
    }
  });
</script>

<script src="/js/transition.js"></script>
</body>
</html>
</body>
</html>